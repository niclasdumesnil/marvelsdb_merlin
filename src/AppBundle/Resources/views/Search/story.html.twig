{% extends 'AppBundle::layout.html.twig' %}



{% block body %}

<script src="/bundles/app/js/ui.stories.js"></script>

{% set show_spoilers = true %}
<div style="margin-left:200px; margin-right:200px;">
    <h1>Stories</h1>

    {# Utilise les variables combinées passées par le contrôleur #}
    <div style="margin-bottom: 24px;">
        <div id="combined-stats-panel">
            {% include 'AppBundle:Search:set_stats.html.twig' with {
                stats: combined_stats,
                color: '#111',
                label: 'Statistiques combinées des sets sélectionnés :',
                type_counts: combined_type_counts,
                boost_counts: combined_boost_counts,
                traits: combined_traits,
                set_name: combined_set_name
            } %}
        </div>
    </div>

    <div style="display: flex; align-items: flex-end; gap: 32px; margin-bottom: 18px;">
        <div>
            <div style="font-weight:bold; margin-bottom:6px;">Villain</div>
            <select id="villain-sets" name="villain_set" style="width: 100%;">
                {% for set in filtered_villain_sets %}
                    <option value="{{ set.code }}"
                        {% if set.code == selected_villain_code %}selected{% endif %}>
                        {{ set.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div>
            <div style="font-weight:bold; margin-bottom:6px;">Modular</div>
            <select id="modular-sets" name="modular_set" style="width: 100%;">
                {% for set in filtered_modular_sets %}
                    <option value="{{ set.code }}"
                        {% if set.code == selected_modular_code %}selected{% endif %}>
                        {{ set.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div style="margin-top: 32px;">
        <div style="display: flex; gap: 18px;">
            <button id="tab-villain" type="button"
                style="padding: 8px 18px; border-radius: 6px; border: none; background: #eee; color: #222; font-weight: bold; cursor:pointer;">
                Villain
            </button>
            <button id="tab-modular" type="button"
                style="padding: 8px 18px; border-radius: 6px; border: none; background: #ce7222ff; color: #fff; font-weight: bold; cursor:pointer;">
                Modular
            </button>
        </div>

        <div id="tab-villain-content" style="display:block;">
            <div style="height:18px;"></div>
            {% if filtered_villain_sets|length > 0 %}
                {% for set in filtered_villain_sets %}
                    <div class="villain-cards-panel" id="villain-cards-{{ set.code }}" style="{% if set.code != selected_villain_code %}display:none;{% endif %}">
                        {% include 'AppBundle:Search:set_stats.html.twig' with {
                            stats: villain_set_stats[set.code],
                            color: '#445566ff',
                            label: 'Statistiques du set villain sélectionné :',
                            type_counts: villain_set_type_counts[set.code],
                            boost_counts: villain_set_boost_counts[set.code],
                            traits: villain_traits_by_set[set.code],
                            set_name: set.name
                        } %}
                        {% if villain_cards_by_set[set.code]|length > 0 %}
                            {% include 'AppBundle:Search:display-card-list.html.twig' with {
                                cards: villain_cards_by_set[set.code],
                                set: set
                            } %}
                        {% endif %}
                    </div>
                {% endfor %}
            {% endif %}
        </div>

        <div id="tab-modular-content" style="display:none;">
            <div style="height:18px;"></div>
            {% if filtered_modular_sets|length > 0 %}
                {% for set in filtered_modular_sets %}
                    <div class="set-infos-panel" id="infos-{{ set.code }}" style="{% if set.code != selected_modular_code %}display:none;{% endif %}">
                        {% include 'AppBundle:Search:set_stats.html.twig' with {
                            stats: modular_set_stats[set.code],
                            color: '#445566ff',
                            label: 'Statistiques du set modular sélectionné :',
                            type_counts: modular_set_type_counts[set.code],
                            boost_counts: modular_set_boost_counts[set.code],
                            traits: modular_traits_by_set[set.code],
                            set_name: set.name
                        } %}
                    </div>
                {% endfor %}
            {% endif %}
            <div>
                {% if filtered_modular_sets|length > 0 %}
                    {% for set in filtered_modular_sets %}
                        <div class="set-cards-panel" id="cards-{{ set.code }}" style="{% if set.code != selected_modular_code %}display:none;{% endif %}">
                            {% if modular_cards_by_set[set.code]|length > 0 %}
                                {% include 'AppBundle:Search:display-card-list.html.twig' with {
                                    cards: modular_cards_by_set[set.code],
                                    set: set
                                } %}
                            {% endif %}
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}
