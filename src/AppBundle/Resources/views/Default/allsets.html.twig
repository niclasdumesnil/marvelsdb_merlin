{% set creator_colors = {
    'default': 'rgb(18, 120, 216)',
    'createur1': 'rgb(158, 14, 187)',
    'createur2': 'rgb(3, 88, 84)'
} %}
{% set creator_labels = {
    'Merlin': 'Merlin',
    'Designhacker': 'Hax'
} %}

<ul class="nav nav-tabs" id="packsTabs" role="tablist" style="margin-bottom:1em;">
    <li class="nav-item" role="presentation">
        <a class="nav-link active" id="ffg-tab" data-toggle="tab" href="#ffg" role="tab" aria-controls="ffg" aria-selected="true">Current</a>
    </li>
    <li class="nav-item" role="presentation">
        <a class="nav-link" id="fanmade-tab" data-toggle="tab" href="#fanmade" role="tab" aria-controls="fanmade" aria-selected="false">Fan made</a>
    </li>
    {% if app.user and app.user.donation == "1" %}
    <li class="nav-item" role="presentation">
        <a class="nav-link" id="private-tab" data-toggle="tab" href="#private" role="tab" aria-controls="private" aria-selected="false">Private</a>
    </li>
    {% endif %}
</ul>
<div class="tab-content" id="packsTabsContent">
    <div class="tab-pane fade show active" id="ffg" role="tabpanel" aria-labelledby="ffg-tab">
        <ol style="margin-top: 0.5em;">
            <h3 style="margin-top: 0; margin-bottom: 0.1em;">FFG</h3>
            {% for pack in data %}
                {% if pack.creator == 'FFG' %}
                    {% if pack.type == 'core' or pack.type == 'story' or pack.type =='encounter' %}
                        <li>
                            <a href="{{ pack.url }}">{{ pack.name }}</a>
                            <span>
                                {% if pack.available == false %}({{ pack.known }} cards){% endif %}
                            </span>
                        </li>
                    {% else %}
                        <li style="margin-left:2em;">
                            <a href="{{ pack.url }}">{{ pack.name }}</a>
                            <span>
                                {% if pack.available == false %}({{ pack.known }} cards){% endif %}
                            </span>
                        </li>
                    {% endif %}
                {% endif %}
            {% endfor %}
        </ol>
    </div>
    <div class="tab-pane fade" id="fanmade" role="tabpanel" aria-labelledby="fanmade-tab">
        <ol style="margin-top: 0.5em;">
            <h3 style="margin-top: 0; margin-bottom: 0.1em;">Fan made</h3>
            {% set fan_types = [] %}
            {% for pack in data %}
                {% if pack.creator != 'FFG' and pack.visibility != "false" and (pack.type is not empty) and (pack.type not in fan_types) %}
                    {% set fan_types = fan_types|merge([pack.type]) %}
                {% endif %}
            {% endfor %}
            {% for type in fan_types %}
                {% for pack in data %}
                    {% if pack.creator != 'FFG' and pack.visibility != "false" and pack.type == type %}
                        <li style="margin-left:0em;">
                            <a title="{{ pack.name }}" href="{{ pack.url }}">{{ pack.name }}
                                {% set color = creator_colors[pack.creator] ?? creator_colors['default'] %}
                                {% set label = creator_labels[pack.creator] ?? (pack.creator ?? 'Unknown') %}
                                <span style="font-size: 10px; color: white; background-color: {{ color }}; display: inline-flex;
                                    align-items: center; border-radius: 8px; padding: 2px 12px;">{{ label }}</span>
                                {% if pack.status == "beta" or pack.status == "alpha" %}
                                    <span style="font-size: 10px; color: black; background-color: rgb(216, 150, 8); display: inline-flex;
                                        align-items: center; border-radius: 8px; padding: 2px 12px;">{{ pack.status ?? 'Official' }}</span>
                                {% endif %}
                            </a>
                        </li>
                    {% endif %}
                {% endfor %}
                <br>
            {% endfor %}
        </ol>
    </div>
    {% if app.user and app.user.donation == "1" %}
    <div class="tab-pane fade" id="private" role="tabpanel" aria-labelledby="private-tab">
        <ol style="margin-top: 0.5em;">
            <h3 style="margin-top: 0; margin-bottom: 0.1em;">Private</h3>
            {% for pack in data %}
                {% if pack.creator != 'FFG' and pack.visibility == "false" %}
                    <li style="margin-left:0em;">
                        <a title="{{ pack.name }}" href="{{ pack.url }}">{{ pack.name }}
                            {% set color = creator_colors[pack.creator] ?? creator_colors['default'] %}
                            {% set label = creator_labels[pack.creator] ?? (pack.creator ?? 'Unknown') %}
                            <span style="font-size: 10px; color: white; background-color: {{ color }}; display: inline-flex;
                                align-items: center; border-radius: 8px; padding: 2px 12px;">{{ label }}</span>
                            {% if pack.status == "beta" or pack.status == "alpha" %}
                                <span style="font-size: 10px; color: black; background-color: rgb(216, 150, 8); display: inline-flex;
                                    align-items: center; border-radius: 8px; padding: 2px 12px;">{{ pack.status ?? 'Official' }}</span>
                            {% endif %}
                        </a>
                    </li>
                {% endif %}
            {% endfor %}
        </ol>
    </div>
    {% endif %}
</div>

{# Ajoute ce JS si Bootstrap JS n'est pas déjà chargé #}
<script>
document.querySelectorAll('.nav-link').forEach(function(tab){
    tab.addEventListener('click', function(e){
        e.preventDefault();
        document.querySelectorAll('.nav-link').forEach(function(t){
            t.classList.remove('active');
            t.setAttribute('aria-selected', 'false');
        });
        document.querySelectorAll('.tab-pane').forEach(function(p){ p.classList.remove('show','active'); });
        tab.classList.add('active');
        tab.setAttribute('aria-selected', 'true');
        var pane = document.querySelector(tab.getAttribute('href'));
        pane.classList.add('show','active');
    });
});


</script>